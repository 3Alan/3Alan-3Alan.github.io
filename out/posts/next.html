<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="A statically generated blog example using Next.js and Markdown."/><meta property="og:image" content="https://og-image.now.sh/Next.js%20Blog%20Starter%20Example.png?theme=light&amp;md=1&amp;fontSize=100px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><title>Alan Blog | Next.js学习笔记</title><meta property="og:image" content="/assets/blog/preview/cover.jpg"/><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/0c5d68dec31d5e633d7d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0c5d68dec31d5e633d7d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c08b6362973d9807149c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c08b6362973d9807149c.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-0e4fa088dc7ba14065ae.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.75a33472c97d90b0998e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-6a39c488cbc48222220d.js" as="script"/><link rel="preload" href="/_next/static/chunks/1bfc9850.c33d278050ea4088a86e.js" as="script"/><link rel="preload" href="/_next/static/chunks/252f366e.83fb0478019c66932a1a.js" as="script"/><link rel="preload" href="/_next/static/chunks/31664189.bba9fb0f1e9f49877f50.js" as="script"/><link rel="preload" href="/_next/static/chunks/32e3cb38.25281bc008dc4454bcb1.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.0e7d78c52381b211cb8b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-0015ffae885285ca294d.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><div class="bg-gray-700 hidden sm:flex h-20 fixed inset-0 overflow-hidden z-50"><div class="max-w-screen-lg mx-auto flex w-full justify-between"><div class="py-2 text-center flex items-center px-6"><a href="/"><div class="flex items-center"><div class="text-xl inline-block"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" style="color:#fbb01f" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M212.3 10.3c-43.8 6.3-86.2 24.1-122.2 53.8l77.4 77.4c27.8-35.8 43.3-81.2 44.8-131.2zM248 222L405.9 64.1c-42.4-35-93.6-53.5-145.5-56.1-1.2 63.9-21.5 122.3-58.7 167.7L248 222zM56.1 98.1c-29.7 36-47.5 78.4-53.8 122.2 50-1.5 95.5-17 131.2-44.8L56.1 98.1zm272.2 204.2c45.3-37.1 103.7-57.4 167.7-58.7-2.6-51.9-21.1-103.1-56.1-145.5L282 256l46.3 46.3zM248 290L90.1 447.9c42.4 34.9 93.6 53.5 145.5 56.1 1.3-64 21.6-122.4 58.7-167.7L248 290zm191.9 123.9c29.7-36 47.5-78.4 53.8-122.2-50.1 1.6-95.5 17.1-131.2 44.8l77.4 77.4zM167.7 209.7C122.3 246.9 63.9 267.3 0 268.4c2.6 51.9 21.1 103.1 56.1 145.5L214 256l-46.3-46.3zm116 292c43.8-6.3 86.2-24.1 122.2-53.8l-77.4-77.4c-27.7 35.7-43.2 81.2-44.8 131.2z"></path></svg></div><span class="ml-3 text-xl text-gray-300">Alan</span></div></a></div><div class="py-2 text-center text-sm flex items-center px-6"><a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter" class="hover:text-success duration-200 transition-colors">search-menu</a></div></div></div><main class="sm:mt-20"><div class="sm:mx-0"><img src="https://cdn.jsdelivr.net/gh/ihewro/blog@master/usr/uploads/2019/01/762065921.jpg" alt="Cover Image for 123" class="w-full"/></div><div class="container max-w-screen-lg mx-auto sm:px-5"><div><article class="py-10 rounded-lg px-4 mb-10 bg-white"><h1 class="text-3xl md:text-4xl lg:text-5xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Next.js学习笔记</h1><div class="hidden md:block md:mb-12"></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"></div></div><div class="max-w-screen-lg mx-auto"><div class="markdown-styles_markdown__2gM5e"><p>这段时间工作要求将之前的vue的H5活动页面转移到Next.js下面，经过一段时间的研究，总结出了下面的内容。</p>
<!-- more -->
<h2>什么是Next.js</h2>
<p>基于<code>React</code>的SSR（服务端渲染框架）</p>
<h2>SSR &#x26; CSR</h2>
<blockquote>
<p>参考链接：<a href="https://medium.com/walmartglobaltech/the-benefits-of-server-side-rendering-over-client-side-rendering-5d07ff2cefe8">https://medium.com/walmartglobaltech/the-benefits-of-server-side-rendering-over-client-side-rendering-5d07ff2cefe8</a></p>
</blockquote>
<img src="https://i2.wp.com/blog.logrocket.com/wp-content/uploads/2019/06/ssr-explanation.png?w=800&ssl=1"  />
<blockquote>
<p>The main difference is that for SSR your server’s response to the browser is the HTML of your page that is ready to be rendered, while for CSR the browser gets a pretty empty document with links to your javascript. That means your browser will start rendering the HTML from your server without having to wait for all the JavaScript to be downloaded and executed. In both cases, React will need to be downloaded and go through the same process of building a virtual dom and attaching events to make the page interactive — but for SSR, the user can start viewing the page while all of that is happening. For the CSR world, you need to wait for all of the above to happen and then have the virtual dom moved to the browser dom for the page to be viewable.</p>
</blockquote>
<img src="https://i2.wp.com/blog.logrocket.com/wp-content/uploads/2019/06/csr-explanation.png?w=800&ssl=1"  />
<h2>Next.js的优点</h2>
<ul>
<li>更好的SEO</li>
<li>更快的首屏渲染速度</li>
</ul>
<h2>Next.js 基础(与Rect开发的不同之处)</h2>
<blockquote>
<p><a href="https://www.nextjs.cn/learn/basics/create-nextjs-app?utm_source=next-site&#x26;utm_medium=nav-cta&#x26;utm_campaign=next-website">https://www.nextjs.cn/learn/basics/create-nextjs-app?utm_source=next-site&#x26;utm_medium=nav-cta&#x26;utm_campaign=next-website</a></p>
</blockquote>
<h3>路由映射</h3>
<blockquote>
<p>在 Next.js 中，一个 <strong>page（页面）</strong> 就是一个从 <code>.js</code>、<code>jsx</code>、<code>.ts</code> 或 <code>.tsx</code> 文件导出（export）的 <a href="https://reactjs.org/docs/components-and-props.html">React 组件</a> ，这些文件存放在 <code>pages</code> 目录下。每个 page（页面）都使用其文件名作为路由（route）。</p>
</blockquote>
<pre><code class="hljs language-js">pages/about.js/jsx/ts/tsx → /about

pages/dashboard/settings/username.js → /dashboard/settings/username</code></pre>
<h3>自带路由：<code>next/router</code> <code>next/link</code></h3>
<p>使用与<code>react-router</code>类似，包括编程式跳转<code>router.push</code>以及组件式跳转<code>&#x3C;Link href="/about">&#x3C;a>click me&#x3C;/a>&#x3C;/Link></code></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/router'</span>;

<span class="hljs-keyword">const</span> router = useRouter();
router.push({
  <span class="hljs-attr">pathname</span>: <span class="hljs-string">'/activities/experience-lesson/course-info'</span>,
  <span class="hljs-attr">query</span>: { ...queryData, <span class="hljs-attr">isFree</span>: <span class="hljs-number">0</span> }
});
router.push(<span class="hljs-string">'/about'</span>)</code></pre>
<h3>渲染方式</h3>
<h4>预渲染</h4>
<ul>
<li><strong>静态生成（Static Generation）</strong>（HTML重用、build生成）</li>
<li><strong>服务器端渲染（Server-side Rendering）</strong>（每次请求生成的HTML不同、用户请求时生成）</li>
</ul>
<h4>相关API</h4>
<ul>
<li>
<p>静态生成</p>
<ul>
<li><code>getStaticProps(context)</code></li>
<li><code>getStaticPaths(context)</code></li>
</ul>
</li>
<li>
<p>服务器渲染</p>
<ul>
<li><code>getServerSideProps(context)</code></li>
</ul>
</li>
<li>
<p>客户端获取数据</p>
<ul>
<li>SWR（官方推荐）</li>
</ul>
</li>
</ul>
<p><strong>注意：</strong>在开发环境中<code>getStaticProps</code>和<code>getStaticPaths</code>每次请求都会被调用</p>
<p>使用，在<strong>页面</strong>文件中导出</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Page</span>(<span class="hljs-params">{ data }</span>) </span>{
  <span class="hljs-comment">// Render data...</span>
}

<span class="hljs-comment">// This gets called on every request</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getServerSideProps</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// Fetch data from external API</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">`https://.../data`</span>)
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.json()

  <span class="hljs-comment">// Pass data to the page via props</span>
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">props</span>: { data } }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Page</code></pre>
<h2>项目结构</h2>
<h3>配置Eslint+Prettier</h3>
<blockquote>
<p><a href="https://github.com/paulolramos/eslint-prettier-airbnb-react">https://github.com/paulolramos/eslint-prettier-airbnb-react</a></p>
<p><a href="https://dev.to/karlhadwen/setup-eslint-prettier-airbnb-style-guide-in-under-2-minutes-a27">https://dev.to/karlhadwen/setup-eslint-prettier-airbnb-style-guide-in-under-2-minutes-a27</a></p>
<p><a href="https://dev.to/bybruno/configuring-absolute-paths-in-react-for-web-without-ejecting-en-us-52h6">https://dev.to/bybruno/configuring-absolute-paths-in-react-for-web-without-ejecting-en-us-52h6</a></p>
</blockquote>
<p>解决<code>eslint</code>无法识别动态引入语法<code>import()</code>:</p>
<p><a href="https://github.com/eslint/eslint/issues/11486">相关issue</a></p>
<pre><code class="hljs language-js"><span class="hljs-comment">// eslint 配置</span>
<span class="hljs-attr">parserOptions</span>: {
  <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-number">2020</span>, <span class="hljs-comment">// Use the latest ecmascript standard</span>
  <span class="hljs-attr">sourceType</span>: <span class="hljs-string">'module'</span>, <span class="hljs-comment">// Allows using import/export statements</span>
  <span class="hljs-attr">ecmaFeatures</span>: {
  <span class="hljs-attr">jsx</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// Enable JSX since we're using React</span>
  }
},</code></pre>
<h3>配置alias</h3>
<p><code>next.config.js</code>配置</p>
<pre><code class="hljs language-js"><span class="hljs-comment">/* eslint-disable no-param-reassign */</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">webpack</span>: <span class="hljs-function">(<span class="hljs-params">config</span>) =></span> {
    <span class="hljs-comment">// Note: we provide webpack above so you should not `require` it</span>
    <span class="hljs-comment">// Perform customizations to webpack config</span>
    config.resolve.alias[<span class="hljs-string">'@'</span>] = path.resolve(__dirname, <span class="hljs-string">'./src'</span>);
    <span class="hljs-comment">// Important: return the modified config</span>
    <span class="hljs-keyword">return</span> config;
  }
};
</code></pre>
<p>eslint无法识别alias，需要在根目录下创建文件<code>jsconfig.json</code>并在<code>.eslintrc.js</code>	配置<code>settings</code></p>
<pre><code class="hljs language-js"><span class="hljs-comment">// .eslintrc.js</span>
<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">root</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Make sure eslint picks up the config at the root of the directory</span>
  <span class="hljs-attr">extends</span>: [<span class="hljs-string">'airbnb'</span>, <span class="hljs-string">'airbnb/hooks'</span>, <span class="hljs-string">'plugin:prettier/recommended'</span>, <span class="hljs-string">'prettier/react'</span>],
  <span class="hljs-attr">env</span>: {
    <span class="hljs-attr">browser</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">commonjs</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">es6</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">jest</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">node</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">globals</span>: {
    <span class="hljs-attr">wx</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">parserOptions</span>: {
    <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-number">2020</span>, <span class="hljs-comment">// Use the latest ecmascript standard</span>
    <span class="hljs-attr">sourceType</span>: <span class="hljs-string">'module'</span>, <span class="hljs-comment">// Allows using import/export statements</span>
    <span class="hljs-attr">ecmaFeatures</span>: {
      <span class="hljs-attr">jsx</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// Enable JSX since we're using React</span>
    }
  },
  <span class="hljs-attr">rules</span>: {
    <span class="hljs-string">'react/react-in-jsx-scope'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'jsx-a11y/alt-text'</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// img alt</span>
    <span class="hljs-string">'react/prop-types'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'jsx-a11y/click-events-have-key-events'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'jsx-a11y/no-static-element-interactions'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'dot-notation'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'import/prefer-default-export'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'react/jsx-props-no-spreading'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'jsx-a11y/href-no-hash'</span>: [<span class="hljs-string">'off'</span>],
    <span class="hljs-string">'react/no-array-index-key'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'no-console'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'no-alert'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'consistent-return'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-comment">// eslint-disable-next-line prettier/prettier</span>
    <span class="hljs-attr">eqeqeq</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">'react/self-closing-comp'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'react-hooks/exhaustive-deps'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'react/no-danger'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'no-shadow'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'jsx-a11y/label-has-associated-control'</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">'react/jsx-filename-extension'</span>: [<span class="hljs-string">'warn'</span>, { <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.js'</span>, <span class="hljs-string">'.jsx'</span>] }],
    <span class="hljs-string">'max-len'</span>: [
      <span class="hljs-string">'warn'</span>,
      {
        <span class="hljs-attr">code</span>: <span class="hljs-number">120</span>,
        <span class="hljs-attr">tabWidth</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">comments</span>: <span class="hljs-number">120</span>,
        <span class="hljs-attr">ignoreComments</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">ignoreTrailingComments</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">ignoreUrls</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">ignoreStrings</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">ignoreTemplateLiterals</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">ignoreRegExpLiterals</span>: <span class="hljs-literal">true</span>
      }
    ]
  },
  <span class="hljs-attr">settings</span>: {
    <span class="hljs-string">'import/resolver'</span>: {
      <span class="hljs-attr">alias</span>: {
        <span class="hljs-attr">map</span>: [[<span class="hljs-string">'@'</span>, <span class="hljs-string">'./src'</span>]],
        <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.js'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.json'</span>]
      }
    }
  }
};
</code></pre>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"compilerOptions"</span>: {
    <span class="hljs-attr">"baseUrl"</span>: <span class="hljs-string">"src"</span>,
    <span class="hljs-attr">"paths"</span>: {
      <span class="hljs-attr">"@/*"</span>: [<span class="hljs-string">"./*"</span>]
    }
  },
  <span class="hljs-attr">"exclude"</span>: [<span class="hljs-string">"node_modules"</span>, <span class="hljs-string">"**/node_modules/*"</span>]
}</code></pre>
<h3>封装axios在每次请求时显示<code>spin</code>组件</h3>
<p>这里要注意一点，由于服务端不存在<code>document</code>，所以要判断一下当前所处的环境再去执行操作。</p>
<pre><code class="hljs language-jsx"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> Spin <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/Spin/Spin'</span>;

<span class="hljs-keyword">const</span> Axios = axios.create({
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">20000</span>
});

<span class="hljs-keyword">const</span> csr = process.browser;

<span class="hljs-comment">// 当前正在请求的数量</span>
<span class="hljs-keyword">let</span> requestCount = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showLoading</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (requestCount === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">var</span> dom = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
    dom.setAttribute(<span class="hljs-string">'id'</span>, <span class="hljs-string">'loading'</span>);
    <span class="hljs-built_in">document</span>.body.appendChild(dom);
    ReactDOM.render(<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">Spin</span> /></span></span>, dom);
  }
  requestCount++;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'showLoading'</span>, requestCount);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideLoading</span>(<span class="hljs-params"></span>) </span>{
  requestCount--;
  <span class="hljs-keyword">if</span> (requestCount === <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">document</span>.body.removeChild(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'loading'</span>));
  }
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hideLoading'</span>, requestCount);
}

Axios.interceptors.request.use(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =></span> {
    csr &#x26;&#x26; showLoading();
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-function">(<span class="hljs-params">err</span>) =></span> {
    csr &#x26;&#x26; hideLoading();
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(err);
  }
);

Axios.interceptors.response.use(
  <span class="hljs-function">(<span class="hljs-params">res</span>) =></span> {
    csr &#x26;&#x26; hideLoading();
    <span class="hljs-keyword">return</span> res;
  },
  <span class="hljs-function">(<span class="hljs-params">err</span>) =></span> {
    csr &#x26;&#x26; hideLoading();
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(err);
  }
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Axios;
</code></pre>
<h3>自定义input hook</h3>
<p>使用后可以免去给每个表单组件设置<code>onChange</code></p>
<pre><code class="hljs language-jsx"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 自定义input hook</span>
<span class="hljs-comment">// 参考资料：https://rangle.io/blog/simplifying-controlled-inputs-with-hooks/</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useInput</span>(<span class="hljs-params">initialValue</span>) </span>{
  <span class="hljs-keyword">const</span> [value, setValue] = useState(initialValue);

  <span class="hljs-keyword">return</span> {
    value,
    setValue,
    <span class="hljs-attr">reset</span>: <span class="hljs-function">() =></span> setValue(<span class="hljs-string">''</span>),
    <span class="hljs-attr">bind</span>: {
      value,
      <span class="hljs-attr">onChange</span>: <span class="hljs-function">(<span class="hljs-params">e</span>) =></span> {
        setValue(e.target.value);
      }
    }
  };
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-jsx"><span class="hljs-comment">// 没使用前</span>
<span class="hljs-keyword">const</span> [phone, setPhone] = useState(<span class="hljs-string">''</span>);

<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">input</span>
  <span class="hljs-attr">name</span>=<span class="hljs-string">"phone"</span>
  <span class="hljs-attr">type</span>=<span class="hljs-string">"number"</span>
  <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入您的手机号码(必填)"</span>
  <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">styles</span>['<span class="hljs-attr">cell-content</span>']} ${<span class="hljs-attr">styles</span>['<span class="hljs-attr">cell-content-right</span>']}`}
  <span class="hljs-attr">value</span>=<span class="hljs-string">{phone}</span>
  <span class="hljs-attr">onChange</span>=<span class="hljs-string">{()</span> =></span> setPhone(e.target.value)}
/></span>


<span class="hljs-comment">// 使用后</span>
<span class="hljs-keyword">const</span> { <span class="hljs-attr">value</span>: phone, <span class="hljs-attr">bind</span>: bindPhone } = useInput(<span class="hljs-string">''</span>);

<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">input</span>
  <span class="hljs-attr">name</span>=<span class="hljs-string">"phone"</span>
  <span class="hljs-attr">type</span>=<span class="hljs-string">"number"</span>
  <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入您的手机号码(必填)"</span>
  <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">styles</span>['<span class="hljs-attr">cell-content</span>']} ${<span class="hljs-attr">styles</span>['<span class="hljs-attr">cell-content-right</span>']}`}
  {<span class="hljs-attr">...bindPhone</span>}
/></span></span></code></pre>
<h3>封装Dialog</h3>
<pre><code class="hljs language-jsx"><span class="hljs-keyword">import</span> { createPortal } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./Modal.module.css'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Modal</span>(<span class="hljs-params">{ content, show, onOk }</span>) </span>{
  <span class="hljs-keyword">const</span> modal = show &#x26;&#x26; (
    <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles[</span>'<span class="hljs-attr">overlay</span>']}></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles[</span>'<span class="hljs-attr">modal</span>']}></span>
        {/* 防止冒泡关闭窗口 */}
        <span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles[</span>'<span class="hljs-attr">wrapper</span>']} <span class="hljs-attr">onClick</span>=<span class="hljs-string">{(e)</span> =></span> e.stopPropagation()}>
          <span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles[</span>'<span class="hljs-attr">content</span>']}></span>{content}<span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
          <span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles[</span>'<span class="hljs-attr">readed_btn</span>']} <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =></span> onOk()}>
            好 的
          <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
        <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
      <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
  );

  <span class="hljs-keyword">const</span> ProtalContent = <span class="hljs-function">() =></span> {
    <span class="hljs-comment">// 用来处理服务端不存在document的问题</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 将modal挂在到body上</span>
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span> &#x26;&#x26; createPortal(modal, <span class="hljs-built_in">document</span>.body);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  };

  <span class="hljs-comment">// 动态引入组件</span>
  <span class="hljs-comment">// import dynamic from 'next/dynamic';</span>
  <span class="hljs-comment">// const Modal = dynamic(() => import('./components/Modal/Modal'), { ssr: false });</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&#x3C;></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">ProtalContent</span> /></span>
    <span class="hljs-tag">&#x3C;/></span></span>
  );
}
</code></pre>
<h3>移动端适配</h3>
<p>使用插件<code>postcss-px-to-viewport</code></p>
<p>在根目录下新建文件<code>postcss.config.js</code></p>
<pre><code class="hljs language-js"><span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-string">'postcss-px-to-viewport'</span>: {
      <span class="hljs-comment">// 视窗的宽度，对应的是我们设计稿的宽度，我们公司用的是375</span>
      <span class="hljs-attr">viewportWidth</span>: <span class="hljs-number">375</span>,
      <span class="hljs-comment">// 视窗的高度，根据750设备的宽度来指定，一般指定1334，也可以不配置</span>
      <span class="hljs-comment">// viewportHeight: 1334,</span>
      <span class="hljs-comment">// 指定`px`转换为视窗单位值的小数位数</span>
      <span class="hljs-attr">unitPrecision</span>: <span class="hljs-number">3</span>,
      <span class="hljs-comment">// 指定需要转换成的视窗单位，建议使用vw</span>
      <span class="hljs-attr">viewportUnit</span>: <span class="hljs-string">'vw'</span>,
      <span class="hljs-comment">// 指定不转换为视窗单位的类，可以自定义，可以无限添加,建议定义一至两个通用的类名</span>
      <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">'.ignore'</span>],
      <span class="hljs-comment">// 小于或等于`1px`不转换为视窗单位，你也可以设置为你想要的值</span>
      <span class="hljs-attr">minPixelValue</span>: <span class="hljs-number">1</span>,
      <span class="hljs-comment">// 允许在媒体查询中转换`px`</span>
      <span class="hljs-attr">mediaQuery</span>: <span class="hljs-literal">false</span>
      <span class="hljs-comment">// exclude: undefined</span>
    }
  }
};
</code></pre>
<h3>使用Docker+coding实现自动化部署</h3>
<h4>dockerfile</h4>
<pre><code class="hljs language-dockerfile"><span class="hljs-comment"># node版本号</span>
<span class="hljs-keyword">FROM</span> node:<span class="hljs-number">12</span>-alpine

<span class="hljs-comment"># docker build时传进来的值 docker image build -t &#x3C;name> --build-arg API_ENV=development .</span>
<span class="hljs-keyword">ARG</span> API_ENV

<span class="hljs-keyword">RUN</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-variable">${API_ENV}</span></span>

<span class="hljs-keyword">ENV</span> NEXT_PUBLIC_API_ENV=${API_ENV}

<span class="hljs-comment"># Create app directory</span>
<span class="hljs-keyword">RUN</span><span class="bash"> mkdir -p /usr/src/app</span>
<span class="hljs-keyword">WORKDIR</span><span class="bash"> /usr/src/app</span>

<span class="hljs-comment"># Install app dependencies</span>
<span class="hljs-keyword">COPY</span><span class="bash"> package*.json /usr/src/app/</span>
<span class="hljs-keyword">RUN</span><span class="bash"> npm install</span>

<span class="hljs-comment"># Bundle app source</span>
<span class="hljs-keyword">COPY</span><span class="bash"> . /usr/src/app</span>

<span class="hljs-keyword">RUN</span><span class="bash"> npm run build</span>
<span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">3000</span>

<span class="hljs-keyword">CMD</span><span class="bash"> [ <span class="hljs-string">"npm"</span>, <span class="hljs-string">"run"</span>, <span class="hljs-string">"start"</span> ]</span></code></pre>
<p>在coding上设置代码push触发规则，触发生成制品库。</p>
<h3>使用redux</h3>
<blockquote>
<p><a href="https://github.com/vercel/next.js/tree/canary/examples/with-redux">https://github.com/vercel/next.js/tree/canary/examples/with-redux</a></p>
<p><a href="https://github.com/vercel/next.js/tree/canary/examples/with-redux-thunk">https://github.com/vercel/next.js/tree/canary/examples/with-redux-thunk</a></p>
</blockquote>
<p>里面有使用到一个js新特性<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator">Nullish coalescing operator</a></p>
<h2>Next.js 踩坑</h2>
<h3>环境变量配置</h3>
<p>环境变量在客户端无法获取，背景：由于我在项目中需要根据环境变量来使用不同环境的API域名。</p>
<p>解决方案：官方提供了以<code>NEXT_PUBLIC_</code>开头的环境变量名，这样就可以在客户端和服务端都访问得到环境变量了。</p>
</div></div></article><div id="vcomments"></div></div></div></main></div><footer class="text-gray-600 body-font bg-gray-800"><div class="px-5 py-8 flex items-center sm:flex-row flex-col"><a class="flex title-font font-medium items-center md:justify-start justify-center text-gray-900"><div class="text-lg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" style="color:#fbb01f" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M212.3 10.3c-43.8 6.3-86.2 24.1-122.2 53.8l77.4 77.4c27.8-35.8 43.3-81.2 44.8-131.2zM248 222L405.9 64.1c-42.4-35-93.6-53.5-145.5-56.1-1.2 63.9-21.5 122.3-58.7 167.7L248 222zM56.1 98.1c-29.7 36-47.5 78.4-53.8 122.2 50-1.5 95.5-17 131.2-44.8L56.1 98.1zm272.2 204.2c45.3-37.1 103.7-57.4 167.7-58.7-2.6-51.9-21.1-103.1-56.1-145.5L282 256l46.3 46.3zM248 290L90.1 447.9c42.4 34.9 93.6 53.5 145.5 56.1 1.3-64 21.6-122.4 58.7-167.7L248 290zm191.9 123.9c29.7-36 47.5-78.4 53.8-122.2-50.1 1.6-95.5 17.1-131.2 44.8l77.4 77.4zM167.7 209.7C122.3 246.9 63.9 267.3 0 268.4c2.6 51.9 21.1 103.1 56.1 145.5L214 256l-46.3-46.3zm116 292c43.8-6.3 86.2-24.1 122.2-53.8l-77.4-77.4c-27.7 35.7-43.2 81.2-44.8 131.2z"></path></svg></div><span class="ml-3 text-xl text-gray-300">Alan</span></a><p class="text-sm text-gray-500 sm:ml-4 sm:pl-4 sm:border-l-2 sm:border-gray-300 sm:py-2 sm:mt-0 mt-4">© 2021 Alan —<a href="https://github.com/3Alan" class="text-gray-600 ml-1" rel="noopener noreferrer" target="_blank">@Alan</a></p><span class="inline-flex sm:ml-auto sm:mt-0 mt-4 justify-center sm:justify-start"><a class="mr-4 text-gray-500"><div class="text-lg text-gray-400"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path></svg></div></a><a class="text-gray-500"><div class="text-lg text-gray-400"><svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1.1" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.198c-4.418 0-8 3.582-8 8 0 3.535 2.292 6.533 5.471 7.591 0.4 0.074 0.547-0.174 0.547-0.385 0-0.191-0.008-0.821-0.011-1.489-2.226 0.484-2.695-0.944-2.695-0.944-0.364-0.925-0.888-1.171-0.888-1.171-0.726-0.497 0.055-0.486 0.055-0.486 0.803 0.056 1.226 0.824 1.226 0.824 0.714 1.223 1.872 0.869 2.328 0.665 0.072-0.517 0.279-0.87 0.508-1.070-1.777-0.202-3.645-0.888-3.645-3.954 0-0.873 0.313-1.587 0.824-2.147-0.083-0.202-0.357-1.015 0.077-2.117 0 0 0.672-0.215 2.201 0.82 0.638-0.177 1.322-0.266 2.002-0.269 0.68 0.003 1.365 0.092 2.004 0.269 1.527-1.035 2.198-0.82 2.198-0.82 0.435 1.102 0.162 1.916 0.079 2.117 0.513 0.56 0.823 1.274 0.823 2.147 0 3.073-1.872 3.749-3.653 3.947 0.287 0.248 0.543 0.735 0.543 1.481 0 1.070-0.009 1.932-0.009 2.195 0 0.213 0.144 0.462 0.55 0.384 3.177-1.059 5.466-4.057 5.466-7.59 0-4.418-3.582-8-8-8z"></path></svg></div></a></span></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Next.js学习笔记","date":"2020-03-16T05:35:07.322Z","slug":"next","content":"\u003cp\u003e这段时间工作要求将之前的vue的H5活动页面转移到Next.js下面，经过一段时间的研究，总结出了下面的内容。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2\u003e什么是Next.js\u003c/h2\u003e\n\u003cp\u003e基于\u003ccode\u003eReact\u003c/code\u003e的SSR（服务端渲染框架）\u003c/p\u003e\n\u003ch2\u003eSSR \u0026#x26; CSR\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e参考链接：\u003ca href=\"https://medium.com/walmartglobaltech/the-benefits-of-server-side-rendering-over-client-side-rendering-5d07ff2cefe8\"\u003ehttps://medium.com/walmartglobaltech/the-benefits-of-server-side-rendering-over-client-side-rendering-5d07ff2cefe8\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cimg src=\"https://i2.wp.com/blog.logrocket.com/wp-content/uploads/2019/06/ssr-explanation.png?w=800\u0026ssl=1\"  /\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThe main difference is that for SSR your server’s response to the browser is the HTML of your page that is ready to be rendered, while for CSR the browser gets a pretty empty document with links to your javascript. That means your browser will start rendering the HTML from your server without having to wait for all the JavaScript to be downloaded and executed. In both cases, React will need to be downloaded and go through the same process of building a virtual dom and attaching events to make the page interactive — but for SSR, the user can start viewing the page while all of that is happening. For the CSR world, you need to wait for all of the above to happen and then have the virtual dom moved to the browser dom for the page to be viewable.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cimg src=\"https://i2.wp.com/blog.logrocket.com/wp-content/uploads/2019/06/csr-explanation.png?w=800\u0026ssl=1\"  /\u003e\n\u003ch2\u003eNext.js的优点\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e更好的SEO\u003c/li\u003e\n\u003cli\u003e更快的首屏渲染速度\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eNext.js 基础(与Rect开发的不同之处)\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.nextjs.cn/learn/basics/create-nextjs-app?utm_source=next-site\u0026#x26;utm_medium=nav-cta\u0026#x26;utm_campaign=next-website\"\u003ehttps://www.nextjs.cn/learn/basics/create-nextjs-app?utm_source=next-site\u0026#x26;utm_medium=nav-cta\u0026#x26;utm_campaign=next-website\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3\u003e路由映射\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e在 Next.js 中，一个 \u003cstrong\u003epage（页面）\u003c/strong\u003e 就是一个从 \u003ccode\u003e.js\u003c/code\u003e、\u003ccode\u003ejsx\u003c/code\u003e、\u003ccode\u003e.ts\u003c/code\u003e 或 \u003ccode\u003e.tsx\u003c/code\u003e 文件导出（export）的 \u003ca href=\"https://reactjs.org/docs/components-and-props.html\"\u003eReact 组件\u003c/a\u003e ，这些文件存放在 \u003ccode\u003epages\u003c/code\u003e 目录下。每个 page（页面）都使用其文件名作为路由（route）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003epages/about.js/jsx/ts/tsx → /about\n\npages/dashboard/settings/username.js → /dashboard/settings/username\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e自带路由：\u003ccode\u003enext/router\u003c/code\u003e \u003ccode\u003enext/link\u003c/code\u003e\u003c/h3\u003e\n\u003cp\u003e使用与\u003ccode\u003ereact-router\u003c/code\u003e类似，包括编程式跳转\u003ccode\u003erouter.push\u003c/code\u003e以及组件式跳转\u003ccode\u003e\u0026#x3C;Link href=\"/about\"\u003e\u0026#x3C;a\u003eclick me\u0026#x3C;/a\u003e\u0026#x3C;/Link\u003e\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useRouter } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'next/router'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e router = useRouter();\nrouter.push({\n  \u003cspan class=\"hljs-attr\"\u003epathname\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/activities/experience-lesson/course-info'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003equery\u003c/span\u003e: { ...queryData, \u003cspan class=\"hljs-attr\"\u003eisFree\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e }\n});\nrouter.push(\u003cspan class=\"hljs-string\"\u003e'/about'\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e渲染方式\u003c/h3\u003e\n\u003ch4\u003e预渲染\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e静态生成（Static Generation）\u003c/strong\u003e（HTML重用、build生成）\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e服务器端渲染（Server-side Rendering）\u003c/strong\u003e（每次请求生成的HTML不同、用户请求时生成）\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e相关API\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e静态生成\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003egetStaticProps(context)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003egetStaticPaths(context)\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e服务器渲染\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003egetServerSideProps(context)\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e客户端获取数据\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSWR（官方推荐）\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003e注意：\u003c/strong\u003e在开发环境中\u003ccode\u003egetStaticProps\u003c/code\u003e和\u003ccode\u003egetStaticPaths\u003c/code\u003e每次请求都会被调用\u003c/p\u003e\n\u003cp\u003e使用，在\u003cstrong\u003e页面\u003c/strong\u003e文件中导出\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ePage\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ data }\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// Render data...\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// This gets called on every request\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetServerSideProps\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// Fetch data from external API\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e res = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e fetch(\u003cspan class=\"hljs-string\"\u003e`https://.../data`\u003c/span\u003e)\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e res.json()\n\n  \u003cspan class=\"hljs-comment\"\u003e// Pass data to the page via props\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e { \u003cspan class=\"hljs-attr\"\u003eprops\u003c/span\u003e: { data } }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e Page\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e项目结构\u003c/h2\u003e\n\u003ch3\u003e配置Eslint+Prettier\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/paulolramos/eslint-prettier-airbnb-react\"\u003ehttps://github.com/paulolramos/eslint-prettier-airbnb-react\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://dev.to/karlhadwen/setup-eslint-prettier-airbnb-style-guide-in-under-2-minutes-a27\"\u003ehttps://dev.to/karlhadwen/setup-eslint-prettier-airbnb-style-guide-in-under-2-minutes-a27\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://dev.to/bybruno/configuring-absolute-paths-in-react-for-web-without-ejecting-en-us-52h6\"\u003ehttps://dev.to/bybruno/configuring-absolute-paths-in-react-for-web-without-ejecting-en-us-52h6\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e解决\u003ccode\u003eeslint\u003c/code\u003e无法识别动态引入语法\u003ccode\u003eimport()\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/eslint/eslint/issues/11486\"\u003e相关issue\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// eslint 配置\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eparserOptions\u003c/span\u003e: {\n  \u003cspan class=\"hljs-attr\"\u003eecmaVersion\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2020\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Use the latest ecmascript standard\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003esourceType\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'module'\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Allows using import/export statements\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eecmaFeatures\u003c/span\u003e: {\n  \u003cspan class=\"hljs-attr\"\u003ejsx\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// Enable JSX since we're using React\u003c/span\u003e\n  }\n},\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e配置alias\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003enext.config.js\u003c/code\u003e配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* eslint-disable no-param-reassign */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'path'\u003c/span\u003e);\n\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003ewebpack\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003econfig\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// Note: we provide webpack above so you should not `require` it\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// Perform customizations to webpack config\u003c/span\u003e\n    config.resolve.alias[\u003cspan class=\"hljs-string\"\u003e'@'\u003c/span\u003e] = path.resolve(__dirname, \u003cspan class=\"hljs-string\"\u003e'./src'\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e// Important: return the modified config\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e config;\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eeslint无法识别alias，需要在根目录下创建文件\u003ccode\u003ejsconfig.json\u003c/code\u003e并在\u003ccode\u003e.eslintrc.js\u003c/code\u003e\t配置\u003ccode\u003esettings\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// .eslintrc.js\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003eroot\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Make sure eslint picks up the config at the root of the directory\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eextends\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'airbnb'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'airbnb/hooks'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'plugin:prettier/recommended'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'prettier/react'\u003c/span\u003e],\n  \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003ebrowser\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ecommonjs\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ees6\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003ejest\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003enode\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-attr\"\u003eglobals\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003ewx\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-attr\"\u003eparserOptions\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eecmaVersion\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2020\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Use the latest ecmascript standard\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003esourceType\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'module'\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Allows using import/export statements\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eecmaFeatures\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003ejsx\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// Enable JSX since we're using React\u003c/span\u003e\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003erules\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e'react/react-in-jsx-scope'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'jsx-a11y/alt-text'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// img alt\u003c/span\u003e\n    \u003cspan class=\"hljs-string\"\u003e'react/prop-types'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'jsx-a11y/click-events-have-key-events'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'jsx-a11y/no-static-element-interactions'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'dot-notation'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'import/prefer-default-export'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'react/jsx-props-no-spreading'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'jsx-a11y/href-no-hash'\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'off'\u003c/span\u003e],\n    \u003cspan class=\"hljs-string\"\u003e'react/no-array-index-key'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'no-console'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'no-alert'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'consistent-return'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// eslint-disable-next-line prettier/prettier\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eeqeqeq\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'react/self-closing-comp'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'react-hooks/exhaustive-deps'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'react/no-danger'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'no-shadow'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'jsx-a11y/label-has-associated-control'\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'react/jsx-filename-extension'\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'warn'\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eextensions\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'.js'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'.jsx'\u003c/span\u003e] }],\n    \u003cspan class=\"hljs-string\"\u003e'max-len'\u003c/span\u003e: [\n      \u003cspan class=\"hljs-string\"\u003e'warn'\u003c/span\u003e,\n      {\n        \u003cspan class=\"hljs-attr\"\u003ecode\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e120\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003etabWidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003ecomments\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e120\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eignoreComments\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eignoreTrailingComments\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eignoreUrls\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eignoreStrings\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eignoreTemplateLiterals\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eignoreRegExpLiterals\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e\n      }\n    ]\n  },\n  \u003cspan class=\"hljs-attr\"\u003esettings\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e'import/resolver'\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003ealias\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003emap\u003c/span\u003e: [[\u003cspan class=\"hljs-string\"\u003e'@'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'./src'\u003c/span\u003e]],\n        \u003cspan class=\"hljs-attr\"\u003eextensions\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'.ts'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'.js'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'.jsx'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'.json'\u003c/span\u003e]\n      }\n    }\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e{\n  \u003cspan class=\"hljs-attr\"\u003e\"compilerOptions\"\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003e\"baseUrl\"\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\"src\"\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003e\"paths\"\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003e\"@/*\"\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\"./*\"\u003c/span\u003e]\n    }\n  },\n  \u003cspan class=\"hljs-attr\"\u003e\"exclude\"\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\"node_modules\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"**/node_modules/*\"\u003c/span\u003e]\n}\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e封装axios在每次请求时显示\u003ccode\u003espin\u003c/code\u003e组件\u003c/h3\u003e\n\u003cp\u003e这里要注意一点，由于服务端不存在\u003ccode\u003edocument\u003c/code\u003e，所以要判断一下当前所处的环境再去执行操作。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e axios \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'axios'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e ReactDOM \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-dom'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Spin \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'../components/Spin/Spin'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e Axios = axios.create({\n  \u003cspan class=\"hljs-attr\"\u003etimeout\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e20000\u003c/span\u003e\n});\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e csr = process.browser;\n\n\u003cspan class=\"hljs-comment\"\u003e// 当前正在请求的数量\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e requestCount = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eshowLoading\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (requestCount === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e dom = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createElement(\u003cspan class=\"hljs-string\"\u003e'div'\u003c/span\u003e);\n    dom.setAttribute(\u003cspan class=\"hljs-string\"\u003e'id'\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'loading'\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.body.appendChild(dom);\n    ReactDOM.render(\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eSpin\u003c/span\u003e /\u003e\u003c/span\u003e\u003c/span\u003e, dom);\n  }\n  requestCount++;\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'showLoading'\u003c/span\u003e, requestCount);\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ehideLoading\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n  requestCount--;\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (requestCount === \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n    \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.body.removeChild(\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById(\u003cspan class=\"hljs-string\"\u003e'loading'\u003c/span\u003e));\n  }\n  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'hideLoading'\u003c/span\u003e, requestCount);\n}\n\nAxios.interceptors.request.use(\n  \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003econfig\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    csr \u0026#x26;\u0026#x26; showLoading();\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e config;\n  },\n  \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    csr \u0026#x26;\u0026#x26; hideLoading();\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.reject(err);\n  }\n);\n\nAxios.interceptors.response.use(\n  \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    csr \u0026#x26;\u0026#x26; hideLoading();\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res;\n  },\n  \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    csr \u0026#x26;\u0026#x26; hideLoading();\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.reject(err);\n  }\n);\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e Axios;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e自定义input hook\u003c/h3\u003e\n\u003cp\u003e使用后可以免去给每个表单组件设置\u003ccode\u003eonChange\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useState } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 自定义input hook\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e// 参考资料：https://rangle.io/blog/simplifying-controlled-inputs-with-hooks/\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003euseInput\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003einitialValue\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [value, setValue] = useState(initialValue);\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n    value,\n    setValue,\n    \u003cspan class=\"hljs-attr\"\u003ereset\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e setValue(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e),\n    \u003cspan class=\"hljs-attr\"\u003ebind\u003c/span\u003e: {\n      value,\n      \u003cspan class=\"hljs-attr\"\u003eonChange\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u003e\u003c/span\u003e {\n        setValue(e.target.value);\n      }\n    }\n  };\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e使用：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 没使用前\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [phone, setPhone] = useState(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e);\n\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"phone\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"number\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"请输入您的手机号码(必填)\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e`${\u003cspan class=\"hljs-attr\"\u003estyles\u003c/span\u003e['\u003cspan class=\"hljs-attr\"\u003ecell-content\u003c/span\u003e']} ${\u003cspan class=\"hljs-attr\"\u003estyles\u003c/span\u003e['\u003cspan class=\"hljs-attr\"\u003ecell-content-right\u003c/span\u003e']}`}\n  \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{phone}\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eonChange\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{()\u003c/span\u003e =\u003e\u003c/span\u003e setPhone(e.target.value)}\n/\u003e\u003c/span\u003e\n\n\n\u003cspan class=\"hljs-comment\"\u003e// 使用后\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e: phone, \u003cspan class=\"hljs-attr\"\u003ebind\u003c/span\u003e: bindPhone } = useInput(\u003cspan class=\"hljs-string\"\u003e''\u003c/span\u003e);\n\n\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003einput\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"phone\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"number\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eplaceholder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\"请输入您的手机号码(必填)\"\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{\u003c/span\u003e`${\u003cspan class=\"hljs-attr\"\u003estyles\u003c/span\u003e['\u003cspan class=\"hljs-attr\"\u003ecell-content\u003c/span\u003e']} ${\u003cspan class=\"hljs-attr\"\u003estyles\u003c/span\u003e['\u003cspan class=\"hljs-attr\"\u003ecell-content-right\u003c/span\u003e']}`}\n  {\u003cspan class=\"hljs-attr\"\u003e...bindPhone\u003c/span\u003e}\n/\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e封装Dialog\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-jsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { createPortal } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'react-dom'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e styles \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'./Modal.module.css'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eModal\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ content, show, onOk }\u003c/span\u003e) \u003c/span\u003e{\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e modal = show \u0026#x26;\u0026#x26; (\n    \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{styles[\u003c/span\u003e'\u003cspan class=\"hljs-attr\"\u003eoverlay\u003c/span\u003e']}\u003e\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{styles[\u003c/span\u003e'\u003cspan class=\"hljs-attr\"\u003emodal\u003c/span\u003e']}\u003e\u003c/span\u003e\n        {/* 防止冒泡关闭窗口 */}\n        \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{styles[\u003c/span\u003e'\u003cspan class=\"hljs-attr\"\u003ewrapper\u003c/span\u003e']} \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{(e)\u003c/span\u003e =\u003e\u003c/span\u003e e.stopPropagation()}\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{styles[\u003c/span\u003e'\u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e']}\u003e\u003c/span\u003e{content}\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{styles[\u003c/span\u003e'\u003cspan class=\"hljs-attr\"\u003ereaded_btn\u003c/span\u003e']} \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{()\u003c/span\u003e =\u003e\u003c/span\u003e onOk()}\u003e\n            好 的\n          \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  );\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ProtalContent = \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// 用来处理服务端不存在document的问题\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// 将modal挂在到body上\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e \u0026#x26;\u0026#x26; createPortal(modal, \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.body);\n    } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n    }\n  };\n\n  \u003cspan class=\"hljs-comment\"\u003e// 动态引入组件\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// import dynamic from 'next/dynamic';\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// const Modal = dynamic(() =\u003e import('./components/Modal/Modal'), { ssr: false });\u003c/span\u003e\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003e\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;\u003cspan class=\"hljs-name\"\u003eProtalContent\u003c/span\u003e /\u003e\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026#x3C;/\u003e\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e移动端适配\u003c/h3\u003e\n\u003cp\u003e使用插件\u003ccode\u003epostcss-px-to-viewport\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e在根目录下新建文件\u003ccode\u003epostcss.config.js\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e'postcss-px-to-viewport'\u003c/span\u003e: {\n      \u003cspan class=\"hljs-comment\"\u003e// 视窗的宽度，对应的是我们设计稿的宽度，我们公司用的是375\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eviewportWidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e375\u003c/span\u003e,\n      \u003cspan class=\"hljs-comment\"\u003e// 视窗的高度，根据750设备的宽度来指定，一般指定1334，也可以不配置\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// viewportHeight: 1334,\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// 指定`px`转换为视窗单位值的小数位数\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eunitPrecision\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e,\n      \u003cspan class=\"hljs-comment\"\u003e// 指定需要转换成的视窗单位，建议使用vw\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eviewportUnit\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'vw'\u003c/span\u003e,\n      \u003cspan class=\"hljs-comment\"\u003e// 指定不转换为视窗单位的类，可以自定义，可以无限添加,建议定义一至两个通用的类名\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eselectorBlackList\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e'.ignore'\u003c/span\u003e],\n      \u003cspan class=\"hljs-comment\"\u003e// 小于或等于`1px`不转换为视窗单位，你也可以设置为你想要的值\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eminPixelValue\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n      \u003cspan class=\"hljs-comment\"\u003e// 允许在媒体查询中转换`px`\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003emediaQuery\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// exclude: undefined\u003c/span\u003e\n    }\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e使用Docker+coding实现自动化部署\u003c/h3\u003e\n\u003ch4\u003edockerfile\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-dockerfile\"\u003e\u003cspan class=\"hljs-comment\"\u003e# node版本号\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eFROM\u003c/span\u003e node:\u003cspan class=\"hljs-number\"\u003e12\u003c/span\u003e-alpine\n\n\u003cspan class=\"hljs-comment\"\u003e# docker build时传进来的值 docker image build -t \u0026#x3C;name\u003e --build-arg API_ENV=development .\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eARG\u003c/span\u003e API_ENV\n\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e \u003cspan class=\"hljs-built_in\"\u003eecho\u003c/span\u003e \u003cspan class=\"hljs-variable\"\u003e${API_ENV}\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eENV\u003c/span\u003e NEXT_PUBLIC_API_ENV=${API_ENV}\n\n\u003cspan class=\"hljs-comment\"\u003e# Create app directory\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e mkdir -p /usr/src/app\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eWORKDIR\u003c/span\u003e\u003cspan class=\"bash\"\u003e /usr/src/app\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# Install app dependencies\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e package*.json /usr/src/app/\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm install\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# Bundle app source\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eCOPY\u003c/span\u003e\u003cspan class=\"bash\"\u003e . /usr/src/app\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eRUN\u003c/span\u003e\u003cspan class=\"bash\"\u003e npm run build\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eEXPOSE\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eCMD\u003c/span\u003e\u003cspan class=\"bash\"\u003e [ \u003cspan class=\"hljs-string\"\u003e\"npm\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"run\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"start\"\u003c/span\u003e ]\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在coding上设置代码push触发规则，触发生成制品库。\u003c/p\u003e\n\u003ch3\u003e使用redux\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/vercel/next.js/tree/canary/examples/with-redux\"\u003ehttps://github.com/vercel/next.js/tree/canary/examples/with-redux\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/vercel/next.js/tree/canary/examples/with-redux-thunk\"\u003ehttps://github.com/vercel/next.js/tree/canary/examples/with-redux-thunk\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e里面有使用到一个js新特性\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator\"\u003eNullish coalescing operator\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003eNext.js 踩坑\u003c/h2\u003e\n\u003ch3\u003e环境变量配置\u003c/h3\u003e\n\u003cp\u003e环境变量在客户端无法获取，背景：由于我在项目中需要根据环境变量来使用不同环境的API域名。\u003c/p\u003e\n\u003cp\u003e解决方案：官方提供了以\u003ccode\u003eNEXT_PUBLIC_\u003c/code\u003e开头的环境变量名，这样就可以在客户端和服务端都访问得到环境变量了。\u003c/p\u003e\n","ogImage":{"url":"/assets/blog/preview/cover.jpg"},"coverImage":"/assets/blog/preview/cover.jpg"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"next"},"buildId":"fBvHg74_DWWMfFfRdbXx4","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-83732ebf2ed7f8a1b2c7.js"></script><script src="/_next/static/chunks/main-0e4fa088dc7ba14065ae.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" async=""></script><script src="/_next/static/chunks/commons.75a33472c97d90b0998e.js" async=""></script><script src="/_next/static/chunks/pages/_app-6a39c488cbc48222220d.js" async=""></script><script src="/_next/static/chunks/1bfc9850.c33d278050ea4088a86e.js" async=""></script><script src="/_next/static/chunks/252f366e.83fb0478019c66932a1a.js" async=""></script><script src="/_next/static/chunks/31664189.bba9fb0f1e9f49877f50.js" async=""></script><script src="/_next/static/chunks/32e3cb38.25281bc008dc4454bcb1.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.0e7d78c52381b211cb8b.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-0015ffae885285ca294d.js" async=""></script><script src="/_next/static/fBvHg74_DWWMfFfRdbXx4/_buildManifest.js" async=""></script><script src="/_next/static/fBvHg74_DWWMfFfRdbXx4/_ssgManifest.js" async=""></script></body></html>